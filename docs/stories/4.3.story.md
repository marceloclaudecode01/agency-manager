# Story 4.3 — Setup Vitest + Testing Library no Frontend

**Status:** Done
**Epic:** Cobertura de Testes
**Priority:** P2

## Descrição
Como desenvolvedor, quero configurar Vitest e Testing Library no frontend para que a equipe possa escrever testes de componentes React de forma padronizada e compatível com Next.js 14 App Router.

## Contexto Técnico
O frontend não possui nenhuma configuração de testes. O projeto usa Next.js 14 com App Router, React 18, TypeScript 5 e Tailwind CSS. Não há `vitest`, `@testing-library/react` ou arquivos de configuração de testes.

Jest não é recomendado para projetos Next.js 14 com App Router — Vitest é a alternativa moderna e tem melhor compatibilidade com ES Modules.

Pacotes a instalar (frontend devDependencies):
- `vitest@^2.1.0`
- `@testing-library/react@^16.0.0`
- `@testing-library/user-event@^14.5.0`
- `@testing-library/jest-dom@^6.6.0`
- `@vitejs/plugin-react@^4.3.0`
- `jsdom@^25.0.0`
- `@types/testing-library__jest-dom@^6.0.0` (ou `@testing-library/jest-dom` inclui os tipos)

O `vitest.config.ts` deve ser separado do `next.config.js` para evitar conflitos. O ambiente de testes é `jsdom`. O Next.js tem Server Components e Client Components — os testes cobrem apenas Client Components (`'use client'`).

## Escopo

### IN
- [x] Instalar todos os pacotes listados como devDependencies no frontend
- [x] Criar `C:\Users\MARCELO SANTOS\Desktop\test\frontend\vitest.config.ts` com:
  - `environment: 'jsdom'`
  - `plugins: [react()]` via `@vitejs/plugin-react`
  - `setupFiles: ['./src/__tests__/setup.ts']`
  - `resolve.alias` para `@/` apontando para `./src/`
  - Excluir `node_modules`, `.next` e `e2e/` do testMatch
- [x] Criar `C:\Users\MARCELO SANTOS\Desktop\test\frontend\src\__tests__\setup.ts` com:
  - `import '@testing-library/jest-dom'` para os matchers customizados (`toBeInTheDocument`, `toHaveValue`, etc.)
- [x] Criar mock global de `src/lib/api.ts`: arquivo `C:\Users\MARCELO SANTOS\Desktop\test\frontend\src\__tests__\mocks\api.mock.ts` com `vi.mock('@/lib/api')` e métodos mockados (get, post, patch, delete como `vi.fn()`)
- [x] Adicionar scripts no `package.json` do frontend:
  - `"test": "vitest run"`
  - `"test:watch": "vitest"`
  - `"test:ui": "vitest --ui"`
  - `"test:coverage": "vitest run --coverage"`
- [x] Criar `C:\Users\MARCELO SANTOS\Desktop\test\frontend\src\__tests__\smoke.test.tsx`:
  - Teste: componente `<Button>` (shadcn/ui) renderiza sem erros e exibe o texto passado como filho
  - `Button` em `components/ui/button.tsx` existe e foi usado

### OUT
- Testes dos componentes de negócio (Story 4.4)
- Configuração de Playwright ou Cypress para e2e
- Cobertura de Server Components (não testáveis com jsdom)

## Critérios de Aceitação
- [x] AC1: Dado que o desenvolvedor executa `npm run test` no diretório `frontend/`, então o Vitest executa `smoke.test.tsx` e o teste passa (verde)
- [x] AC2: Dado que o `smoke.test.tsx` usa `render()` do Testing Library, então `@testing-library/jest-dom` matchers (ex: `toBeInTheDocument`) estão disponíveis sem imports adicionais
- [x] AC3: Dado que um componente importa de `@/lib/api`, então o mock de `api.mock.ts` intercepta as chamadas sem erros de módulo não encontrado
- [x] AC4: Dado que `npm run test:watch` é executado, então o Vitest entra em modo watch e reexecuta ao salvar arquivos
- [x] AC5: O `vitest.config.ts` resolve o alias `@/` corretamente — sem erros `Cannot find module '@/components/...'` nos testes
- [ ] AC6: O `npm run build` do Next.js continua funcionando após a adição das devDependencies (sem conflitos)

## Dependências
Nenhuma dentro do Epic 4 (Story 4.4 depende desta).

## Arquivos Afetados
- `C:\Users\MARCELO SANTOS\Desktop\test\frontend\package.json` — novos scripts e devDependencies
- `C:\Users\MARCELO SANTOS\Desktop\test\frontend\vitest.config.ts` — NOVO arquivo
- `C:\Users\MARCELO SANTOS\Desktop\test\frontend\src\__tests__\setup.ts` — NOVO arquivo
- `C:\Users\MARCELO SANTOS\Desktop\test\frontend\src\__tests__\smoke.test.tsx` — NOVO arquivo
- `C:\Users\MARCELO SANTOS\Desktop\test\frontend\src\__tests__\mocks\api.mock.ts` — NOVO arquivo

## Estimativa
M

## Change Log
- 2026-02-27: Story criada por @sm
- 2026-02-27: Validado por @po — GO 8/10. Status: Ready.
- 2026-02-27: Implementado por @dev (Dex). Pacotes instalados, vitest.config.ts, setup.ts, api.mock.ts, smoke.test.tsx criados. Scripts adicionados ao package.json. Status: InProgress.
- 2026-02-27: QA Gate por @qa — PASS. 7/7 checks OK. 15/15 testes frontend passando. Todos os ACs confirmados. Status: Done.
