generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  MANAGER
  MEMBER
}

enum ClientStatus {
  ACTIVE
  INACTIVE
  LEAD
}

enum CampaignStatus {
  PLANNING
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  DONE
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum BudgetStatus {
  DRAFT
  SENT
  APPROVED
  REJECTED
}

enum InvoiceStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
}

enum EventType {
  MEETING
  DEADLINE
  DELIVERY
  OTHER
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(MEMBER)
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tasks            Task[]
  calendarEvents   CalendarEvent[]
  sentMessages     Message[]      @relation("SentMessages")
  receivedMessages Message[]      @relation("ReceivedMessages")
  notifications    Notification[]

  @@map("users")
}

model Message {
  id         String   @id @default(cuid())
  content    String
  senderId   String
  receiverId String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())

  sender   User @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String
  title     String
  message   String
  read      Boolean  @default(false)
  taskId    String?
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model Client {
  id        String       @id @default(cuid())
  name      String
  email     String?
  phone     String?
  company   String?
  status    ClientStatus @default(LEAD)
  notes     String?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  campaigns Campaign[]
  budgets   Budget[]
  invoices  Invoice[]

  @@map("clients")
}

model Campaign {
  id          String         @id @default(cuid())
  name        String
  description String?
  clientId    String
  status      CampaignStatus @default(PLANNING)
  startDate   DateTime?
  endDate     DateTime?
  budget      Float?
  goals       String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  client         Client          @relation(fields: [clientId], references: [id], onDelete: Cascade)
  tasks          Task[]
  budgets        Budget[]
  calendarEvents CalendarEvent[]

  @@map("campaigns")
}

model Task {
  id          String       @id @default(cuid())
  title       String
  description String?
  status      TaskStatus   @default(TODO)
  priority    TaskPriority @default(MEDIUM)
  assigneeId  String?
  campaignId  String?
  dueDate     DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  assignee User?     @relation(fields: [assigneeId], references: [id], onDelete: SetNull)
  campaign Campaign? @relation(fields: [campaignId], references: [id], onDelete: SetNull)

  @@map("tasks")
}

model Budget {
  id         String       @id @default(cuid())
  title      String
  clientId   String
  campaignId String?
  items      Json         @default("[]")
  total      Float        @default(0)
  status     BudgetStatus @default(DRAFT)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  client   Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  campaign Campaign? @relation(fields: [campaignId], references: [id], onDelete: SetNull)
  invoices Invoice[]

  @@map("budgets")
}

model Invoice {
  id        String        @id @default(cuid())
  clientId  String
  budgetId  String?
  amount    Float
  status    InvoiceStatus @default(PENDING)
  dueDate   DateTime?
  paidAt    DateTime?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  client Client  @relation(fields: [clientId], references: [id], onDelete: Cascade)
  budget Budget? @relation(fields: [budgetId], references: [id], onDelete: SetNull)

  @@map("invoices")
}

model CalendarEvent {
  id          String    @id @default(cuid())
  title       String
  description String?
  type        EventType @default(OTHER)
  date        DateTime
  endDate     DateTime?
  campaignId  String?
  userId      String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  campaign Campaign? @relation(fields: [campaignId], references: [id], onDelete: SetNull)
  user     User?     @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("calendar_events")
}

enum ScheduledPostStatus {
  PENDING
  APPROVED
  REJECTED
  PUBLISHED
  FAILED
}

model ScheduledPost {
  id           String              @id @default(cuid())
  topic        String
  message      String
  hashtags     String?
  imageUrl     String?
  platform     String?
  scheduledFor DateTime
  status       ScheduledPostStatus @default(PENDING)
  publishedAt  DateTime?
  retryCount   Int                 @default(0)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  @@map("scheduled_posts")
}

model CommentLog {
  id        String   @id @default(cuid())
  commentId String   @unique
  action    String
  reply     String
  createdAt DateTime @default(now())

  @@map("comment_logs")
}

model MetricsReport {
  id                String   @id @default(cuid())
  summary           String
  highlights        Json
  recommendations   Json
  bestPostingTimes  Json
  growthScore       Int
  rawData           Json
  createdAt         DateTime @default(now())

  @@map("metrics_reports")
}

enum ProductCampaignStatus {
  PENDING
  SCHEDULED
  PUBLISHED
  PAUSED
}

model ProductCampaign {
  id              String                @id @default(cuid())
  title           String
  productUrl      String
  imageUrl        String
  productName     String?
  productPrice    String?
  productDesc     String?
  sourceDomain    String?
  generatedCopy   String?
  hashtags        String?
  scheduledPostId String?
  status          ProductCampaignStatus @default(PENDING)
  autoReply       Boolean               @default(true)
  replyTemplate   String?
  fbPostId        String?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  @@map("product_campaigns")
}

model AgentLog {
  id        String   @id @default(cuid())
  from      String   // nome do agente que enviou
  to        String?  // nome do agente destinat√°rio (null = broadcast/sistema)
  type      String   // "info" | "action" | "result" | "error" | "communication"
  message   String
  payload   Json?    // dados extras opcionais
  createdAt DateTime @default(now())

  @@map("agent_logs")
}
